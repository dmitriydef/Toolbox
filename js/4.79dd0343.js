(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"33b4":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[i("q-resize-observer",{on:{resize:e.onResize}}),i("q-toolbar",{staticClass:"justify-between q-py-none bg-grey-9"},[i("div",{staticStyle:{"max-width":"75%"}},[i("q-btn",{staticClass:"q-mr-sm",class:{"q-px-none":e.$q.platform.is.mobile},attrs:{icon:"mdi-arrow-left",flat:"",color:"white"},on:{click:e.goBack}}),i("div",{staticClass:"q-mr-sm",staticStyle:{display:"inline-flex"},style:{maxWidth:e.$q.platform.is.mobile?"35%":"40%"}},[i("q-select",{ref:"itemDeviceSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.active},attrs:{value:e.active,options:e.filteredDevices,filled:"",label:e.active?"Device":"SELECT DEVICE",dark:"","hide-bottom-space":"",dense:"",color:"white",disable:!e.isNeedSelect||!0,"hide-dropdown-icon":!e.isNeedSelect||!0,"virtual-scroll-item-size":48,"virtual-scroll-slice-size":6,"virtual-scroll-sticky-size-start":48,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredDevices.length>6?6:e.filteredDevices.length)+48+(e.filteredDevices.length?0:34)+"px"}},on:{filter:e.filterDevicesSelectItems},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("div",{staticStyle:{"min-height":"77px"}},[i("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemDeviceSelect.filter(t)}},model:{value:e.deviceFilter,callback:function(t){e.deviceFilter=t},expression:"deviceFilter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),i("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedDevice.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-white ellipsis",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(e.selectedDevice.configuration&&e.selectedDevice.configuration.ident?e.selectedDevice.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{staticClass:"text-white",attrs:{side:""}},[e.selectedDevice.deleted?i("q-item-label",{staticClass:"q-pa-none text-right"},[i("small",{staticClass:"cheap-modifier"},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[i("small",[e._v("#"+e._s(e.selectedDevice.id))])])],1)],1)]}},{key:"option",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":t.opt.deleted},attrs:{clickable:""},on:{click:function(i){e.active=t.opt.id,e.$emit("view-data-hide")}}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(t.opt.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(t.opt.configuration&&t.opt.configuration.ident?t.opt.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{attrs:{side:""}},[t.opt.deleted?i("q-item-label",{staticClass:"q-pa-xs text-right"},[i("small",{staticClass:"cheap-modifier cheap-modifier--item",class:{"cheap-modifier--mobile":e.$q.platform.is.mobile}},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[i("small",[e._v("#"+e._s(t.opt.id))])])],1)],1)]}}])},[i("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[i("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemDeviceSelect.filter(t)}},model:{value:e.deviceFilter,callback:function(t){e.deviceFilter=t},expression:"deviceFilter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.$q.platform.is.desktop?i("q-icon",{attrs:{slot:"prepend",name:"mdi-developer-board",color:"white"},slot:"prepend"}):e._e()],1)],1),i("div",{staticStyle:{display:"inline-flex"},style:{maxWidth:e.$q.platform.is.mobile?"35%":"40%"}},[i("q-select",{ref:"itemCalcSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.activeCalcId},attrs:{value:e.activeCalcId,options:e.filteredCalcs,filled:"",clearable:"",label:e.activeCalcId?"Calc":"SELECT CALC",dark:"","hide-bottom-space":"",dense:"",color:"white","virtual-scroll-item-size":48,"virtual-scroll-slice-size":6,"virtual-scroll-sticky-size-start":48,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredCalcs.length>6?6:e.filteredCalcs.length)+48+(e.filteredCalcs.length?0:34)+"px"}},on:{clear:function(t){e.clearActiveCalc(),e.$emit("view-data-hide")},filter:e.filterCalcsSelectItems},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("div",{staticStyle:{"min-height":"77px"}},[i("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemCalcSelect.filter(t)}},model:{value:e.calcFilter,callback:function(t){e.calcFilter=t},expression:"calcFilter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),i("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(t){return[e.selectedCalc?i("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedCalc.name||"<noname>"))])],1),i("q-item-section",{staticClass:"text-white",attrs:{side:""}},[e.selectedCalc.deleted?i("q-item-label",{staticClass:"q-pa-none text-right"},[i("small",{staticClass:"cheap-modifier"},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[i("small",[e._v("#"+e._s(e.selectedCalc.id))])])],1)],1):e._e()]}},{key:"option",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":t.opt.deleted},attrs:{clickable:""},on:{click:function(i){e.setActiveCalc(t.opt.id),e.$emit("view-data-hide")}}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(t.opt.name||"<noname>"))])],1),i("q-item-section",{attrs:{side:""}},[t.opt.deleted?i("q-item-label",{staticClass:"q-pa-xs text-right"},[i("small",{staticClass:"cheap-modifier cheap-modifier--item",class:{"cheap-modifier--mobile":e.$q.platform.is.mobile}},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[i("small",[e._v("#"+e._s(t.opt.id))])])],1)],1)]}}])},[i("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[i("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemCalcSelect.filter(t)}},model:{value:e.calcFilter,callback:function(t){e.calcFilter=t},expression:"calcFilter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.$q.platform.is.desktop?i("q-icon",{attrs:{slot:"prepend",name:"mdi-calculator-variant",color:"white"},slot:"prepend"}):e._e()],1)],1)],1)]),+e.size[1]&&e.active?i("div",[e.activeCalcId&&e.isInit?i("intervals",{ref:"intervals",style:{height:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative",maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"top"===e.mapMinimizedOptions.type?"66%":""},attrs:{activeId:e.activeCalcId,item:e.selectedCalc,activeDeviceId:e.active,isEnabled:!!+e.size[1],limit:0,config:e.config.intervals},on:{"view-data":e.viewDataHandler,"on-map":e.onMapHandler,"in-messages":function(t){return e.viewedInterval=t},"change:date-range":function(t){e.dateRange=t,e.viewedInterval=null}}}):e.activeCalcId?e._e():i("div",{staticClass:"text-grey text-center q-pt-lg",staticStyle:{"font-size":"2.5rem"},style:{minHeight:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"}},[e._v("\n      Select calc\n    ")]),e.activeCalcId&&e.isInit&&+e.size[1]?i("messages",{ref:"messages",style:[{height:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},{maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"messages"===e.mapMinimizedOptions.type?"66%":""}],attrs:{item:e.selectedDevice,intervalModuleName:e.config.intervals.devicesMessages.vuexModuleName,interval:e.viewedInterval,dateRange:e.dateRange,activeId:e.active,limit:e.limit,config:e.messagesConfig},on:{"view-data":e.viewDataHandler}}):e._e()],1):e._e(),e.active&&e.activeCalcId&&e.hasRouteIntervals&&e.$q.platform.is.desktop&&e.isVisibleMap?i("map-frame",{ref:"map",attrs:{device:e.selectedDevice,siblingHeight:e.siblingHeight},on:{"map:close":function(t){e.isVisibleMap=!1},"map:minimize":e.mapMinimizeHandler}}):e._e()],1)},n=[],a=(i("8e6e"),i("8a81"),i("456d"),i("c5f6"),i("7f7f"),i("ac6a"),i("cadf"),i("06db"),i("8615"),i("c47a")),o=i.n(a),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.actions,items:e.messages,dateRange:[e.begin,e.end],viewConfig:e.viewConfig,colsConfigurator:"toolbar",filter:e.filter,theme:e.theme,title:"Intervals",loading:e.loadingFlag,autoscroll:!0,scrollOffset:"10%",item:e.listItem,itemprops:e.getItemsProps},on:{"change:filter":e.filterChangeHandler,"change:date-range":e.dateRangeChangeHandler,"update:cols":e.updateColsHandler,"action:to-bottom":e.actionToBottomHandler,"edit:cols":e.colsEditHandler}},[i("empty-pane",{attrs:{slot:"empty",config:e.config.emptyState},slot:"empty"})],1)],1)},r=[],l=(i("6762"),i("2fdb"),i("967e")),m=i.n(l),d=(i("96cf"),i("fa84")),h=i.n(d),u=i("de45"),f=i("2b0e"),p=i("cdde"),g=i("ef95"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px"}},[e.item["__connectionStatus"]?i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",border:"solid 1px #000",color:"#000",fontWeight:"bold",backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0",backgroundImage:"url(./statics/police.png)",overflow:"hidden",opacity:".7"},attrs:{title:e.date.formatDate(1e3*e.item.timestamp,"DD/MM/YYYY HH:mm:ss")}},e._l(Array(10),(function(t){return i("span",{key:t,staticClass:"text-uppercase",staticStyle:{padding:"0 5px","margin-left":"150px"},style:{backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0"}},[e._v("\n    "+e._s(e.item["__connectionStatus"])+"\n  ")])})),0):i("div",{staticClass:"cursor-pointer",class:[e.item["x-flespi-status"]?"missed-items":"",e.highlighted?"bg-purple-9":""],style:{height:e.itemHeight+"px",width:e.rowWidth+"px",backgroundColor:e.selected?"rgba(255,255,255,0.7)":"",color:e.selected?"#333":""},on:{click:function(t){return e.itemClickHandler(e.index,e.clearItem)}}},[e._l(e.cols,(function(t,s){var n,a,o;return["action"===t.__dest?i("span",{key:t.name+s,staticClass:"list__item item_actions",class:(n={},n["item_"+s]=!0,n)},e._l(e.actions,(function(t,s){return i("q-icon",{key:s,staticClass:"cursor-pointer on-left",class:t.classes,attrs:{name:t.icon},nativeOn:{click:function(i){return i.stopPropagation(),e.clickHandler(e.index,t.type,e.clearItem)}}},[i("q-tooltip",[e._v(e._s(t.label))])],1)})),1):"etc"===t.__dest?i("span",{key:t.name+s,staticClass:"list__item item_etc",class:(a={},a["item_"+s]=!0,a)},[e._v(e._s(e.values.etc.value||"*Empty*"))]):i("span",{key:t.name+s,staticClass:"list__item",class:(o={},o["item_"+s]=!0,o),attrs:{title:e.values[t.name].value}},[e._v("\n        "+e._s(e.values[t.name].value)+"\n      ")])]}))],2)])},b=[],$=(i("4917"),i("8993")),x=i.n($),w=(i("28a5"),i("bd4c")),y={props:["item","index","actions","cols","itemHeight","rowWidth","selected","highlighted"],data:function(){return{date:w["b"]}},computed:{values:function(){var e=this,t={};return t=this.cols.length?this.cols.reduce((function(e,t,i,s){return e[t.name]={value:null},t.type&&(e[t.name].type=t.type),i===s.length-1&&(e.etc={value:""}),e}),{}):{etc:{value:""}},Object.keys(this.item).forEach((function(i){if(-1!==i.indexOf("#")){var s=i.split("#"),n=s[0],a=s[1];if(t[n]){if(t[n].value){if("object"!==x()(t[n].value)){var c=t[n].value;t[n].value=o()({},a-1,c)}}else t[n].value={};t[n].value[a]=JSON.stringify(e.item[i])}else t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}else if(t[i]){var r=e.item[i];(i.match(/timestamp$/)||"begin"===i||"end"===i)&&(r=w["b"].formatDate(1e3*r,"DD/MM/YYYY HH:mm:ss")),-1!==i.indexOf("image.bin.")&&(r="<binary image>"),t[i].value="string"===typeof r?r:JSON.stringify(r)}else-1!==i.indexOf("image.bin.")?t.etc.value+="".concat(i,": <binary image>"):t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")})),Object.keys(t).forEach((function(e){if("object"===x()(t[e].value)&&t[e].value)if(t[e].value instanceof Array){var i=t[e].value.reduce((function(e,t,i,s){return e+=t,i!==s.length-1&&(e+=", "),e}),"");t[e].value=i}else if(t[e].value instanceof Object){var s=Object.keys(t[e].value).reduce((function(i,s,n,a){return i+="".concat(s,": ").concat(t[e].value[s]),n!==a.length-1&&(i+=", "),i}),"");t[e].value=s}})),t},clearItem:function(){var e=this;return Object.keys(this.item).reduce((function(t,i){return t[i]=e.item[i],t}),{})}},methods:{clickHandler:function(e,t,i){this.$emit("action",{index:e,type:t,content:i})},itemClickHandler:function(e,t){this.$emit("item-click",{index:e,content:t})}}},C=y,M=(i("e439"),i("2877")),_=Object(M["a"])(C,v,b,!1,null,null,null),N=_.exports,H=i("121a"),z={props:["item","activeId","activeDeviceId","limit","config"],data:function(){return{listItem:N,theme:this.config.theme,viewConfig:this.config.viewConfig,moduleName:this.config.vuexModuleName,viewedInterval:null}},computed:{actions:function(){var e=this.config.actions,t=this.getRouteFields(),i=[e[0]];return t&&t.length&&this.$q.platform.is.desktop&&(i=e),i},messages:{get:function(){var e=this.$store.state[this.moduleName].messages;return e=Object.values(e),e.sort((function(e,t){return e.begin-t.begin})),this.normalizeSelected(e),e},set:function(e){this.$store.commit("".concat(this.moduleName,"/setMessages"),e)}},active:{get:function(){return this.$store.state[this.moduleName].active},set:function(e){var t=this;return h()(m.a.mark((function i(){return m.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$store.dispatch("".concat(t.moduleName,"/unsubscribePooling"));case 2:return t.$store.commit("".concat(t.moduleName,"/setActive"),e),t.$store.commit("".concat(t.moduleName,"/clearMessages")),t.$store.dispatch("".concat(t.moduleName,"/getCols"),t.item.counters),i.next=7,t.$store.dispatch("".concat(t.moduleName,"/initTime"));case 7:return t.$emit("change:date-range",[t.begin,t.end]),i.next=10,t.$store.dispatch("".concat(t.moduleName,"/get"));case 10:t.$store.dispatch("".concat(t.moduleName,"/pollingGet"));case 11:case"end":return i.stop()}}),i)})))()}},activeDevice:{get:function(){return this.$store.state[this.moduleName].activeDevice},set:function(e){var t=this;return h()(m.a.mark((function i(){return m.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$store.dispatch("".concat(t.moduleName,"/unsubscribePooling"));case 2:return t.$store.commit("".concat(t.moduleName,"/setActiveDevice"),e),t.$store.commit("".concat(t.moduleName,"/clearMessages")),i.next=6,t.$store.dispatch("".concat(t.moduleName,"/initTime"));case 6:return t.$emit("change:date-range",[t.begin,t.end]),i.next=9,t.$store.dispatch("".concat(t.moduleName,"/get"));case 9:t.$store.dispatch("".concat(t.moduleName,"/pollingGet"));case 10:case"end":return i.stop()}}),i)})))()}},cols:{get:function(){return this.$store.state[this.moduleName].cols},set:function(e){this.$store.commit("".concat(this.moduleName,"/updateCols"),e)}},filter:{get:function(){return this.$store.state[this.moduleName].filter},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFilter"),e):this.$store.commit("".concat(this.moduleName,"/setFilter"),"")}},begin:{get:function(){return this.$store.state[this.moduleName].begin},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setBegin"),e):this.$store.commit("".concat(this.moduleName,"/setBegin"),0)}},end:{get:function(){return this.$store.state[this.moduleName].end},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setEnd"),e):this.$store.commit("".concat(this.moduleName,"/setEnd"),0)}},reverse:{get:function(){return this.$store.state[this.moduleName].reverse||!1},set:function(e){this.$store.commit("".concat(this.moduleName,"/setReverse"),e)}},currentLimit:{get:function(){return this.$store.state[this.moduleName].limit},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setLimit"),e):this.$store.commit("".concat(this.moduleName,"/setLimit"),0)}},selected:{get:function(){var e=this.$store.state[this.moduleName].selected;return e&&!e.length&&this.$emit("view-data",null),e},set:function(e){this.$store.commit("".concat(this.moduleName,"/setSelected"),e)}},routesFileds:function(){return this.getRouteFields()},loadingFlag:function(){var e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)}},methods:{getItemsProps:function(e,t){var i=this.messages[e];t.key=i["x-flespi-message-key"],t.props.etcVisible=this.etcVisible,t.props.actionsVisible=this.actionsVisible,t.props.selected=this.selected.includes(e),t.props.highlighted=this.viewedInterval&&i.id===this.viewedInterval.id,t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.viewMessagesHandler},resetParams:function(){this.$refs.scrollList.resetParams()},filterChangeHandler:function(e){this.filter!==e&&(this.filter=e,this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.$store.dispatch("".concat(this.moduleName,"/get")))},getRouteFields:function(){return this.item.counters&&this.item.counters.filter((function(e){return"route"===e.type}))},updateColsHandler:function(e){this.cols=e},dateRangeChangeHandler:function(e){var t=e[0],i=e[1];if(this.begin===t&&this.end===i)return!1;this.begin=t,this.end=i,this.$emit("change:date-range",e),this.viewedInterval=null,this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.$store.dispatch("".concat(this.moduleName,"/get"))},actionHandler:function(e){var t=e.index,i=e.type,s=e.content;switch(i){case"view":this.viewMessagesHandler({index:t,content:s});break;case"map":this.onMapHandler({index:t,content:s});break;case"copy":this.copyMessageHandler({index:t,content:s});break;case"messages":this.inMessagesHandler({index:t,content:s});break}},actionToBottomHandler:function(){this.$refs.scrollList.scrollTo(this.messages.length-1)},viewMessagesHandler:function(e){var t=e.index,i=e.content;this.selected=[t],this.$emit("view-data",i)},onMapHandler:function(e){var t=this,i=(e.index,e.content),s=Object.keys(i).reduce((function(e,s){return t.routesFileds.filter((function(e){return e.name===s})).length&&e.push(i[s]),e}),[]);this.$emit("on-map",s)},inMessagesHandler:function(e){e.index;var t=e.content;this.viewedInterval&&t.id===this.viewedInterval.id?this.viewedInterval=null:this.viewedInterval=t,this.$emit("in-messages",this.viewedInterval)},copyMessageHandler:function(e){var t=this,i=(e.index,e.content);Object(p["a"])(JSON.stringify(i)).then((function(e){t.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(function(e){t.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},unselect:function(){this.selected.length&&(this.selected=[])},normalizeSelected:function(e){if(this.selected&&this.selected.length){var t=this.selected[0],i=e[t];this.viewMessagesHandler({index:t,content:i})}},colsEditHandler:function(){this.$eventBus.$emit("cols:edit","logs")}},watch:{activeId:function(e){this.active=e},activeDeviceId:function(e){this.activeDevice=e},limit:function(e){this.currentLimit=e}},created:function(){var e=this;this.$store.state[this.moduleName]?this.$store.commit("".concat(this.moduleName,"/clear")):this.$store.registerModule(this.moduleName,Object(u["f"])({Vue:f["default"],LocalStorage:this.$q.localStorage,name:this.moduleName,errorHandler:function(t){e.$store.commit("reqFailed",t)},filterHandler:this.filterMessages})),this.currentLimit=this.limit,this.activeId&&(this.$store.commit("".concat(this.moduleName,"/setActive"),this.activeId),this.$store.dispatch("".concat(this.moduleName,"/getCols"),this.item.counters)),this.activeDeviceId&&this.$store.commit("".concat(this.moduleName,"/setActiveDevice"),this.activeDeviceId),this.$store.dispatch("".concat(this.moduleName,"/initTime")).then((function(){e.$emit("change:date-range",[e.begin,e.end]),e.$store.dispatch("".concat(e.moduleName,"/get")),e.$store.dispatch("".concat(e.moduleName,"/pollingGet"))})),this.offlineHandler=f["default"].connector.socket.on("offline",(function(){e.$store.commit("".concat(e.moduleName,"/setOffline"),!0)})),this.connectHandler=f["default"].connector.socket.on("connect",(function(){e.$store.state[e.moduleName].offline&&e.$store.commit("".concat(e.moduleName,"/setReconnected"),!0)}))},beforeDestroy:function(){this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling")),void 0!==this.offlineHandler&&f["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&f["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit("".concat(this.moduleName,"/clear"))},mixins:[g["a"]],components:{VirtualScrollList:u["c"],EmptyPane:H["a"]}},k=z,q=Object(M["a"])(k,c,r,!1,null,null,null),I=q.exports,O=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.actions,items:e.messages,dateRange:e.dateRange,viewConfig:e.viewConfig,colsConfigurator:"toolbar",filter:e.filter,theme:e.theme,title:"Messages",loading:e.loadingFlag,autoscroll:e.realtimeEnabled,scrollOffset:"10%",item:e.listItem,itemprops:e.getItemsProps},on:{"change:filter":e.filterChangeHandler,"scroll:top":e.paginationPrevChangeHandler,"scroll:bottom":e.paginationNextChangeHandler,"action:to-bottom":e.actionToBottomHandler,"update:cols":e.updateColsHandler,"edit:cols":e.colsEditHandler}},[i("empty-pane",{attrs:{slot:"empty",config:e.config.emptyState},slot:"empty"})],1)],1)},S=[],D=i("4db1"),E=i.n(D),R=(i("551c"),i("5df3"),i("20d6"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px"}},[e.item["__connectionStatus"]?i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",border:"solid 1px #000",color:"#000",fontWeight:"bold",backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0",backgroundImage:"url(./statics/police.png)",overflow:"hidden",opacity:".7"},attrs:{title:e.date.formatDate(1e3*e.item.timestamp,"DD/MM/YYYY HH:mm:ss")}},e._l(Array(10),(function(t){return i("span",{key:t,staticClass:"text-uppercase",staticStyle:{padding:"0 5px","margin-left":"150px"},style:{backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0"}},[e._v("\n    "+e._s(e.item["__connectionStatus"])+"\n  ")])})),0):i("div",{staticClass:"cursor-pointer",class:[e.item["x-flespi-status"]?"missed-items":"",e.selected?"bg-white-opasity":e.highlightLevel?"text-"+e.highlightType+"-"+e.highlightLevel:"",e.highlighted?"bg-purple-9":""],style:{height:e.itemHeight+"px",width:e.rowWidth+"px",color:e.selected?"#333":""},on:{click:function(t){return e.itemClickHandler(e.index,e.clearItem)}}},[e._l(e.cols,(function(t,s){var n,a,o;return["action"===t.__dest?i("span",{key:t.name+s,staticClass:"list__item item_actions",class:(n={},n["item_"+s]=!0,n)},e._l(e.actions,(function(t,s){return i("q-icon",{key:s,staticClass:"cursor-pointer on-left",class:t.classes,attrs:{name:t.icon},nativeOn:{click:function(i){return i.stopPropagation(),e.clickHandler(e.index,t.type,e.clearItem)}}},[i("q-tooltip",[e._v(e._s(t.label))])],1)})),1):"etc"===t.__dest?i("span",{key:t.name+s,staticClass:"list__item item_etc",class:(a={},a["item_"+s]=!0,a)},[e._v(e._s(e.values.etc.value||"*Empty*"))]):i("span",{key:t.name+s,staticClass:"list__item",class:(o={},o["item_"+s]=!0,o),attrs:{title:e.values[t.name].value}},[e._v("\n        "+e._s(e.values[t.name].value)+"\n      ")])]}))],2)])}),T=[],L={props:["item","index","actions","cols","itemHeight","rowWidth","selected","highlighted"],data:function(){var e=0,t="";return this.item.timestamp<this.item["server.timestamp"]-1800?(t="orange",e=10):this.item.timestamp<this.item["server.timestamp"]-600?(t="orange",e=7):this.item.timestamp<this.item["server.timestamp"]-120?(t="orange",e=4):this.item.timestamp-1>this.item["server.timestamp"]?(t="grey",e=6):this.item.timestamp-60>this.item["server.timestamp"]?(t="grey",e=8):this.item.timestamp-1800>this.item["server.timestamp"]&&(t="grey",e=10),{highlightType:t,highlightLevel:e,date:w["b"]}},computed:{values:function(){var e=this,t={};return t=this.cols.length?this.cols.reduce((function(e,t,i,s){return e[t.name]={value:null},i===s.length-1&&(e.etc={value:""}),e}),{}):{etc:{value:""}},Object.keys(this.item).forEach((function(i){if(-1!==i.indexOf("#")){var s=i.split("#"),n=s[0],a=s[1];if(t[n]){if(t[n].value){if("object"!==x()(t[n].value)){var c=t[n].value;t[n].value=o()({},a-1,c)}}else t[n].value={};t[n].value[a]=JSON.stringify(e.item[i])}else t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}else if(t[i]){var r=e.item[i];i.match(/timestamp$/)&&(r=w["b"].formatDate(1e3*r,"DD/MM/YYYY HH:mm:ss")),-1!==i.indexOf("image.bin.")&&(r="<binary image>"),t[i].value="string"===typeof r?r:JSON.stringify(r)}else{if(-1!==i.indexOf("x-flespi"))return!1;-1!==i.indexOf("image.bin.")?t.etc.value+="".concat(i,": <binary image>"):t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}})),Object.keys(t).forEach((function(e){if("object"===x()(t[e].value)&&t[e].value)if(t[e].value instanceof Array){var i=t[e].value.reduce((function(e,t,i,s){return e+=t,i!==s.length-1&&(e+=", "),e}),"");t[e].value=i}else if(t[e].value instanceof Object){var s=Object.keys(t[e].value).reduce((function(i,s,n,a){return i+="".concat(s,": ").concat(t[e].value[s]),n!==a.length-1&&(i+=", "),i}),"");t[e].value=s}})),t},clearItem:function(){var e=this;return Object.keys(this.item).reduce((function(t,i){return-1!==i.indexOf("x-flespi")||(t[i]=e.item[i]),t}),{})}},methods:{clickHandler:function(e,t,i){this.$emit("action",{index:e,type:t,content:i})},itemClickHandler:function(e,t){this.$emit("item-click",{index:e,content:t})}}},P=L,j=(i("a846"),Object(M["a"])(P,R,T,!1,null,null,null)),F=j.exports,W={props:["item","activeId","intervalModuleName","interval","dateRange","limit","config"],data:function(){return{listItem:F,theme:this.config.theme,viewConfig:this.config.viewConfig,actions:this.config.actions,moduleName:this.config.vuexModuleName}},computed:{messages:{get:function(){return this.$store.state[this.moduleName].messages},set:function(e){this.$store.commit("".concat(this.moduleName,"/setMessages"),e)}},intervals:function(){return this.$store.state[this.moduleName].messages},active:{get:function(){return this.$store.state[this.moduleName].active},set:function(e){var t=this;return h()(m.a.mark((function i(){return m.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$store.dispatch("".concat(t.moduleName,"/unsubscribePooling"));case 2:return t.$store.commit("".concat(t.moduleName,"/setActive"),e),t.$store.commit("".concat(t.moduleName,"/clearMessages")),i.next=6,t.$store.dispatch("".concat(t.moduleName,"/getCols"),{actions:!0,etc:!0});case 6:return i.next=8,t.getMessages();case 8:case"end":return i.stop()}}),i)})))()}},cols:{get:function(){return this.$store.state[this.moduleName].cols},set:function(e){this.$store.commit("".concat(this.moduleName,"/updateCols"),e)}},filter:{get:function(){return this.$store.state[this.moduleName].filter},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFilter"),e):this.$store.commit("".concat(this.moduleName,"/setFilter"),"")}},from:{get:function(){return this.$store.state[this.moduleName].from},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFrom"),e):this.$store.commit("".concat(this.moduleName,"/setFrom"),0)}},to:{get:function(){return this.$store.state[this.moduleName].to},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setTo"),e):this.$store.commit("".concat(this.moduleName,"/setTo"),0)}},realtimeEnabled:function(){return this.$store.state[this.moduleName].realtimeEnabled},reverse:{get:function(){return this.$store.state[this.moduleName].reverse||!1},set:function(e){this.$store.commit("".concat(this.moduleName,"/setReverse"),e)}},currentLimit:{get:function(){return this.$store.state[this.moduleName].limit},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setLimit"),e):this.$store.commit("".concat(this.moduleName,"/setLimit"),1e3)}},selected:{get:function(){return this.$store.state[this.moduleName].selected},set:function(e){this.$store.commit("".concat(this.moduleName,"/setSelected"),e)}},loadingFlag:function(){var e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)}},methods:{getItemsProps:function(e,t){var i=this.messages[e];t.key=i["x-flespi-message-key"],t.props.etcVisible=this.etcVisible,t.props.actionsVisible=this.actionsVisible,t.props.selected=this.selected.includes(e),t.props.highlighted=this.interval&&i.timestamp>=this.interval.begin&&i.timestamp<=this.interval.end,t.on||(t.on={}),t.on.action=this.actionHandler,t.on["item-click"]=this.viewMessagesHandler},getMessages:function(){var e=this;return h()(m.a.mark((function t(){return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.to<=Date.now())){t.next=5;break}return t.next=3,e.$store.dispatch("".concat(e.moduleName,"/get"));case 3:t.next=8;break;case 5:return t.next=7,e.$store.dispatch("".concat(e.moduleName,"/getHistory"),1e3);case 7:e.$refs.scrollList.scrollTo(e.messages.length-1);case 8:case"end":return t.stop()}}),t)})))()},resetParams:function(){this.$refs.scrollList.resetParams()},filterChangeHandler:function(e){this.filter!==e&&(this.filter=e,this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.getMessages())},updateColsHandler:function(e){this.cols=e},dateRangeChangeHandler:function(e){var t=e[0],i=e[1];if(this.from===t&&this.to===i)return!1;this.from=t,this.to=i,this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.getMessages()},paginationPrevChangeHandler:function(){var e=this;this.$store.dispatch("".concat(this.moduleName,"/getPrevPage")).then((function(t){t&&"number"===typeof t&&e.$refs.scrollList.scrollToWithSavePadding(t)}))},paginationNextChangeHandler:function(){var e=this;this.$store.dispatch("".concat(this.moduleName,"/getNextPage")).then((function(t){t&&"number"===typeof t&&e.$refs.scrollList.scrollTo(e.messages.length-t)}))},showMessagesByInterval:function(){var e=this;return h()(m.a.mark((function t(){var i,s,n,a,o,c,r;return m.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i=e.interval,i){t.next=3;break}return t.abrupt("return");case 3:if(s=e.messages.findIndex((function(e){return e.timestamp===i.begin})),-1===s){t.next=8;break}e.$refs.scrollList.scrollTo(s-1),t.next=23;break;case 8:return e.$store.state[e.moduleName].messages=[],t.next=11,e.$store.dispatch("".concat(e.moduleName,"/getMessages"),{from:i.begin,to:i.end,count:e.limit});case 11:if(n=t.sent,a=Math.ceil((e.limit-n.length)/2),!(n.length<e.limit)){t.next=20;break}return t.next=16,Promise.all([e.$store.dispatch("".concat(e.moduleName,"/getMessages"),{to:i.begin-1,count:a,reverse:!0}),e.$store.dispatch("".concat(e.moduleName,"/getMessages"),{from:i.end+1,count:a})]);case 16:o=t.sent,c=o[0].reverse(),r=o[1],n.splice.apply(n,[0,0].concat(E()(c))),n.splice.apply(n,[n.length,0].concat(E()(r)));case 20:e.$store.state[e.moduleName].pages=[n.length],e.$store.commit("".concat(e.moduleName,"/setHistoryMessages"),n),e.$nextTick((function(){e.$refs.scrollList.scrollTo(a-1)}));case 23:case"end":return t.stop()}}),t)})))()},actionHandler:function(e){var t=e.index,i=e.type,s=e.content;switch(i){case"view":this.viewMessagesHandler({index:t,content:s});break;case"copy":this.copyMessageHandler({index:t,content:s});break}},viewMessagesHandler:function(e){var t=e.index,i=e.content;this.selected=[t],this.$emit("view-data",i)},copyMessageHandler:function(e){var t=this,i=(e.index,e.content);Object(p["a"])(JSON.stringify(i)).then((function(e){t.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(function(e){t.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},actionToBottomHandler:function(){var e=this;this.realtimeEnabled?this.$refs.scrollList.scrollTo(this.messages.length-1):this.$store.dispatch("".concat(this.moduleName,"/getHistory"),1e3).then((function(){e.$refs.scrollList.scrollTo(e.messages.length-1)}))},unselect:function(){this.selected.length&&(this.selected=[])},colsEditHandler:function(){this.$eventBus.$emit("cols:edit","messages")}},watch:{activeId:function(e){this.active=e},limit:function(e){this.currentLimit=e},dateRange:function(e){this.dateRangeChangeHandler(e)},interval:function(){this.showMessagesByInterval()}},created:function(){var e=this;this.$store.state[this.moduleName]?this.$store.commit("".concat(this.moduleName,"/clear")):this.$store.registerModule(this.moduleName,Object(u["e"])({Vue:f["default"],LocalStorage:this.$q.localStorage,name:this.moduleName,errorHandler:function(t){e.$store.commit("reqFailed",t)},filterHandler:this.filterMessages})),this.currentLimit=this.limit,this.activeId&&(this.active=this.activeId),this.offlineHandler=f["default"].connector.socket.on("offline",(function(){e.$store.commit("".concat(e.moduleName,"/setOffline"),e.realtimeEnabled)})),this.connectHandler=f["default"].connector.socket.on("connect",(function(){e.$store.state[e.moduleName].offline&&(e.$store.commit("".concat(e.moduleName,"/setReconnected"),e.realtimeEnabled),e.realtimeEnabled&&e.$store.dispatch("".concat(e.moduleName,"/getMissedMessages")))}))},beforeDestroy:function(){this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling")),void 0!==this.offlineHandler&&f["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&f["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit("".concat(this.moduleName,"/clear"))},mixins:[g["a"]],components:{VirtualScrollList:u["c"],EmptyPane:H["a"]}},V=W,A=Object(M["a"])(V,O,S,!1,null,null,null),Y=A.exports,J=i("2f62"),B=i("286e"),G=function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("vue-draggable-resizable",{ref:"dragResize",staticClass:"map-component__wrapper",class:[t.isMapMinimized||t.isMapMaximized?"map-component--minimized":""],style:t.wrapperStyles,attrs:{active:!0,x:t.startX,y:t.startY,w:t.width,h:t.height,minw:100,minh:100,parent:!0},on:{resizing:t.mapResizeHandler,dragging:t.draggingHandler}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isMapMinimized&&!t.isMapMaximized,expression:"!isMapMinimized && !isMapMaximized"}],staticClass:"map-container__header",staticStyle:{"padding-right":"1px","padding-top":"3px"},style:{height:t.headerMapHeight+"px"}},[s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-close",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.closeMapHandler(e)}}}),s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:t.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.maximizeHandler(e)}}}),0!==t.siblingHeight?s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-arrow-bottom-right",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.minimizeHandler("bottom")}}}):t._e(),100!==t.siblingHeight?s("q-icon",{staticClass:"float-right cursor-pointer",class:(e={},e["height"+t.siblingHeight]=!0,e),attrs:{name:"mdi-arrow-top-right",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.minimizeHandler("top")}}}):t._e()],1),s("div",{staticClass:"relative-position",style:t.mapStyles,attrs:{id:"map"}},[s("iframe",{ref:"frame",staticClass:"absolute-top-left absolute-bottom-right",staticStyle:{width:"100%",height:"100%"},attrs:{src:t.link,frameborder:"0"}})]),t.isMapMinimized||t.isMapMaximized?s("div",{staticClass:"map-component__custom-controls"},[s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-close",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.closeMapHandler(e)}}}),t.isMapMinimized?s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-window-restore",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.restoreHandler(e)}}}):t._e(),t.isMapMaximized?s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:t.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.maximizeHandler(e)}}}):t._e()],1):t._e()])},X=[],K=i("fb19"),Q=i.n(K),U={name:"map-frame",props:["device","siblingHeight"],data:function(){return{link:"https://flespi.io/mapview",height:520,width:500,prevWidth:0,prevHeight:0,headerMapHeight:20,startX:50,startY:50,isMapMinimized:!1,isMapMaximized:!1,minimizeTo:"",winWidth:0,winHeight:0,lastCommand:null}},computed:{mapStyles:function(){var e={};return this.device&&(e.width="".concat(this.width,"px"),e.height="".concat(this.height-(this.isMapMinimized||this.isMapMaximized?0:this.headerMapHeight),"px")),e},wrapperStyles:function(){var e={};return this.device&&(e={width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),position:"absolute",backgroundColor:"#666"}),e}},methods:{closeMapHandler:function(){this.$emit("map:close"),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},maximizeHandler:function(){this.isMapMaximized?(this.width=this.prevWidth,this.height=this.prevHeight,this.isMapMaximized=!1):(this.prevWidth=this.width,this.prevHeight=this.height,this.maximize())},minimizeHandler:function(e){this.$emit("map:minimize",{type:e,value:!0}),this.prevWidth=this.width,this.prevHeight=this.height,this.isMapMinimized=!0,this.minimizeTo=e,this.isMapMaximized&&(this.isMapMaximized=!1)},restoreHandler:function(){this.$emit("map:minimize",{value:!0}),this.isMapMinimized=!1,this.minimizeTo="",this.$refs.dragResize.left=50,this.$refs.dragResize.top=50},minimize:function(e){var t=this,i=parseInt(this.$el.parentNode.clientWidth,10),s=parseInt(this.$el.parentNode.clientHeight,10);switch(this.width=.34*i,this.height=(s-50)*((this.siblingHeight||100)/100),e){case"bottom":this.$nextTick((function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=s-t.height}));break;case"top":this.$nextTick((function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=50}))}},maximize:function(){var e=this,t=parseInt(this.$el.parentNode.clientWidth,10)-1,i=parseInt(this.$el.parentNode.clientHeight,10)-4;this.width=t,this.height=i,this.$nextTick((function(){e.$refs.dragResize.left=0,e.$refs.dragResize.top=0})),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized=!0},mapResizeHandler:function(e,t,i,s){this.width=i,this.height=s},onWindowResize:function(e){if(this.isMapMinimized)this.minimizeHandler(this.minimizeTo),this.minimize(this.minimizeTo);else if(this.isMapMaximized)this.maximize();else{if(this.winWidth>e.width){var t=this.$refs.dragResize.left,i=this.winWidth-e.width;t+this.width>=this.winWidth-30&&(t&&(t-=i,t<0&&(i=-1*t,t=0),this.$refs.dragResize.left=t),0===t&&(this.$refs.dragResize.width-=i,this.width-=i,this.width<100&&(this.$refs.dragResize.width=100,this.width=100)))}if(this.winHeight>e.height){var s=this.$refs.dragResize.top,n=this.winHeight-e.height;s+this.height>=this.winHeight-30&&(s&&(s-=n,s<0&&(n=-1*s,s=0),this.$refs.dragResize.top=s),0===s&&(this.$refs.dragResize.height-=n,this.height-=n,this.height<100&&(this.$refs.dragResize.height=100,this.height=100)))}this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth}},draggingHandler:function(){this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},addMarker:function(e){},addRoute:function(e){this.lastCommand='MapView|cmd:{"addgroutes": ['.concat(JSON.stringify(e),'], "clear": "all"}'),this.sendCommand(this.lastCommand)},addRoutes:function(e){this.lastCommand='MapView|cmd:{"addgroutes": '.concat(JSON.stringify(e),', "clear": "all"}'),this.sendCommand(this.lastCommand)},clear:function(){this.lastCommand=null,this.sendCommand('MapView|cmd:{"clear": "all"}')},sendCommand:function(e){this.$refs.frame&&e&&this.$refs.frame.contentWindow.postMessage(e,"*")}},mounted:function(){this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth},created:function(){var e=this;window.addEventListener("message",(function(t){'MapView|state:{"ready": true}'===t.data&&e.sendCommand(e.lastCommand)}))},watch:{minimizeTo:function(e){e?this.minimize(e):(this.width=this.prevWidth,this.height=this.prevHeight)},"$q.screen.width":{immediate:!0,handler:function(e){this.onWindowResize({height:this.$q.screen.height,width:e})}},"$q.screen.height":{immediate:!0,handler:function(e){this.onWindowResize({width:this.$q.screen.width,height:e})}}},components:{VueDraggableResizable:Q.a}},Z=U,ee=(i("a38c"),Object(M["a"])(Z,G,X,!1,null,null,null)),te=ee.exports;function ie(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function se(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(i),!0).forEach((function(t){o()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ie(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var ne={props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config"],mixins:[B["a"]],data:function(){return{calcFilter:"",deviceFilter:"",active:null,activeCalcId:null,ratio:50,isInit:!1,isItemsInit:!1,isVisibleMap:!1,siblingHeight:0,mapMinimizedOptions:{},activeViewedMessage:null,messagesConfig:this.config.intervals.devicesMessages,viewedInterval:null,dateRange:[0,0]}},computed:se({},Object(J["d"])({tokenType:function(e){return e.tokenInfo&&e.tokenInfo.access?e.tokenInfo.access.type:-1},devicesCollection:function(e){return e.devices||{}},tasksCollection:function(e){return e.tasks||{}},calcsCollection:function(e){return e.calcs||{}}}),{devices:function(){return Object.values(this.devicesCollection)},tasks:function(){var e=Object.values(this.tasksCollection);return e},calcs:function(){return Object.values(this.calcsCollection)},selectedDevice:function(){return this.devicesCollection[this.active]||{}},selectedCalc:function(){return this.calcsCollection[this.activeCalcId]?this.calcsCollection[this.activeCalcId]:{}},filteredDevices:function(){var e=this.devices;return e},filteredCalcs:function(){var e=this,t=this.calcs;return t=t.filter((function(t){return e.tasks.some((function(i){return e.active===i.device_id&&t.id===i.calc_id}))})),this.isInit&&this.active&&this.activeCalcId&&!this.tasks.filter((function(t){return t.device_id===e.active&&t.calc_id===e.activeCalcId})).length&&this.$nextTick((function(){e.clearActiveCalc()})),this.filterItems(t,this.calcFilter.toLowerCase())},size:function(){return[this.ratio,100-this.ratio]},hasRouteIntervals:function(){return!0}}),methods:se({filterItems:function(e,t){var i=t?e.filter((function(e){return e&&"undefined"!==typeof e.name&&null!==e.name&&e.name.toLowerCase().indexOf(t)>=0||e&&"undefined"!==typeof e.id&&null!==e.id&&(e.id+"").indexOf(t)>=0})):e;return i.sort((function(e,t){if(!e.name)return-1;if(!t.name)return 1;var i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:1})),i}},Object(J["b"])(["getDeleted"]),{filterDevicesSelectItems:function(e,t){var i=this;this.isItemsInit?t():this.itemsLoad("devices",t,this.active,(function(){i.isItemsInit=!0}))},filterCalcsSelectItems:function(e,t){t()},viewDataHandler:function(e){e&&this.$emit("view-data",e)},onMapHandler:function(e){var t=this;if(!this.isVisibleMap)return this.openMapHandler(),this.$nextTick((function(){t.$refs.map.addRoutes(e)})),!1;this.$refs.map&&this.isVisibleMap&&this.$refs.map.addRoutes(e)},unselect:function(){this.$refs.intervals.unselect(),this.$refs.messages.unselect()},setActive:function(e){this.active=e},setActiveCalc:function(e){this.activeCalcId=e},clearActive:function(){this.setActive(null)},clearActiveCalc:function(){this.setActiveCalc(null)},goBack:function(){this.$router.push("/devices/".concat(this.active)).catch((function(e){return e}))},init:function(){var e=this.$route.params&&this.$route.params.id?Number(this.$route.params.id):null,t=this.$route.params&&this.$route.params.calcId?Number(this.$route.params.calcId):null;this.isInit=!0,e&&(this.setActive(e),t&&this.calcsCollection[t]&&(this.activeCalcId=t)),this.$emit("inited")},mapMinimizeHandler:function(e){this.mapMinimizedOptions=e,"bottom"===e.type?this.siblingHeight=this.size[1]:"top"===e.type?this.siblingHeight=this.size[0]:this.siblingHeight=0},openMapHandler:function(){this.isVisibleMap=!this.isVisibleMap},onResize:function(){this.$refs.map&&this.$refs.map.onWindowResize({width:window.innerWidth,height:window.innerHeight})}}),watch:{ratio:function(e){var t=this;this.$nextTick((function(){+t.size[0]&&t.active&&t.$emit("view-data-hide"),+t.size[1]&&t.active&&t.activeCalcId&&t.$refs.intervals.resetParams()}))},$route:function(e){if(e.params&&e.params.id&&Number(e.params.id)===this.active&&e.params.calcId&&this.activeCalcId===Number(e.params.calcId))return!1;if(e.params&&e.params.id){var t=Number(e.params.id);if(this.devicesCollection[t]){t!==this.active&&this.setActive(t);var i=Number(e.params.calcId);e.params&&e.params.calcId&&this.calcsCollection[i]&&(this.activeCalcId=i)}else this.isInit&&this.clearActive()}else e.params&&!e.params.id&&this.clearActive()},active:function(e,t){e?this.$router.push("/devices/".concat(e,"/calc/").concat(this.activeCalcId||"null","/intervals")).catch((function(e){return e})):this.$router.push("/devices").catch((function(e){return e}))},activeCalcId:function(e){e&&this.$router.push("/devices/".concat(this.active,"/calc/").concat(e,"/intervals")).catch((function(e){return e}))}},components:{intervals:I,messages:Y,MapFrame:te}},ae=ne,oe=(i("e28f"),Object(M["a"])(ae,s,n,!1,null,null,null));t["default"]=oe.exports},"43c1":function(e,t,i){},4526:function(e,t,i){},"6df1":function(e,t,i){},a38c:function(e,t,i){"use strict";var s=i("4526"),n=i.n(s);n.a},a846:function(e,t,i){"use strict";var s=i("43c1"),n=i.n(s);n.a},cb1a:function(e,t,i){},e28f:function(e,t,i){"use strict";var s=i("cb1a"),n=i.n(s);n.a},e439:function(e,t,i){"use strict";var s=i("6df1"),n=i.n(s);n.a}}]);