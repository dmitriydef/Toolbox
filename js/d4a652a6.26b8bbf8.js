(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["d4a652a6"],{2378:function(e,t,i){"use strict";var s=i("4dd3"),n=i.n(s);n.a},"44e7":function(e,t,i){"use strict";var s=i("cc75"),n=i.n(s);n.a},"4ac8":function(e,t,i){"use strict";var s=i("bd4c0"),n=i.n(s);n.a},"4dd3":function(e,t,i){},bd4c0:function(e,t,i){},c4c9:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[i("entities-toolbar",{attrs:{item:e.selectedItem,ratio:e.ratio,mode:e.modeModel,actions:e.actions},on:{"change:mode":function(t){return e.modeModel=t},"change:ratio":function(t){return e.ratio=t}}},[i("div",{class:{"middle-modificator":!e.active},staticStyle:{"max-width":"50%"},attrs:{slot:"selects"},slot:"selects"},[i("q-select",{ref:"itemSelect",staticClass:"items__select",class:{"items__select--no-selected":!e.active},attrs:{value:e.active,options:e.filteredItems,filled:"","hide-dropdown-icon":!e.isNeedSelect,label:e.active?"Device":"SELECT DEVICE",dark:"","hide-bottom-space":"",dense:"",color:"white",disable:!e.isNeedSelect,"virtual-scroll-item-size":48,"virtual-scroll-slice-size":6,"virtual-scroll-sticky-size-start":48,"virtual-scroll-sticky-size-end":e.needShowGetDeletedAction&&1===e.tokenType?29:0,"popup-content-class":"items__popup","popup-content-style":{height:48*(e.filteredItems.length>6?6:e.filteredItems.length)+(e.needShowGetDeletedAction&&1===e.tokenType?77:48)+(e.filteredItems.length?0:4)+"px"}},on:{filter:e.filterItems},scopedSlots:e._u([{key:"no-option",fn:function(){return[i("div",{staticStyle:{"min-height":"77px"}},[i("q-input",{staticClass:"q-ma-xs",attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1),i("div",{staticClass:"text-center"},[e._v("No results")])],1)]},proxy:!0},{key:"selected-item",fn:function(t){return[e.selectedItem?i("q-item",e._g(e._b({staticClass:"q-pa-none",staticStyle:{"min-height":"20px","margin-top":"2px","max-width":"100%"}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-none text-white",attrs:{header:""}},[e._v(e._s(e.selectedItem.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-white ellipsis",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(e.selectedItem.configuration&&e.selectedItem.configuration.ident?e.selectedItem.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{staticClass:"text-white",attrs:{side:""}},[e.selectedItem.deleted?i("q-item-label",{staticClass:"q-pa-none text-right"},[i("small",{staticClass:"cheap-modifier"},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right"},[i("small",[e._v("#"+e._s(e.selectedItem.id))])])],1)],1):e._e()]}},{key:"option",fn:function(t){return[i("q-item",e._g(e._b({staticClass:"q-pa-xs",class:{"text-grey-8":t.opt.deleted},attrs:{clickable:""},on:{click:function(i){e.active=t.opt.id,e.$emit("view-data-hide")}}},"q-item",t.itemProps,!1),t.itemEvents),[i("q-item-section",[i("q-item-label",{staticClass:"ellipsis overflow-hidden q-pa-xs",attrs:{header:""}},[e._v(e._s(t.opt.name||"<noname>"))]),i("q-item-label",{staticClass:"q-pa-none q-mt-none",staticStyle:{"line-height":"0.75rem!important","margin-top":"1px"},attrs:{caption:""}},[i("small",[e._v(e._s(t.opt.configuration&&t.opt.configuration.ident?t.opt.configuration.ident:"<no ident>"))])])],1),i("q-item-section",{attrs:{side:""}},[t.opt.deleted?i("q-item-label",{staticClass:"q-pa-xs text-right"},[i("small",{staticClass:"cheap-modifier cheap-modifier--item",class:{"cheap-modifier--mobile":e.$q.platform.is.mobile}},[e._v("DELETED")])]):e._e(),i("q-item-label",{staticClass:"q-pa-none q-mt-none text-right",class:{"q-pr-xs":e.$q.platform.is.mobile}},[i("small",[e._v("#"+e._s(t.opt.id))])])],1)],1)]}}])},[i("div",{staticClass:"bg-dark q-pa-xs select__filter",attrs:{slot:"before-options"},slot:"before-options"},[i("q-input",{attrs:{outlined:"","hide-bottom-space":"",rounded:"",dense:"",color:"white",dark:"",placeholder:"Filter",autofocus:""},on:{input:function(t){return e.$refs.itemSelect.filter(t)}},model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}},[i("q-icon",{attrs:{slot:"prepend",name:"mdi-magnify",color:"white"},slot:"prepend"})],1)],1),e.needShowGetDeletedAction&&1===e.tokenType?i("div",{staticClass:"select__get-deleted",attrs:{slot:"after-options"},slot:"after-options"},[i("q-btn",{staticClass:"deleted-action",attrs:{icon:"mdi-download"},on:{click:e.getDeletedHandler}},[e._v("see deleted")])],1):e._e()])],1)]),e.isInit&&e.active?i("div",[+e.size[0]?i("logs",{ref:"logs",style:[{height:"calc("+e.size[0]+"vh - "+(+e.size[1]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},{maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"logs"===e.mapMinimizedOptions.type?"66%":""}],attrs:{mode:e.mode,item:e.selectedItem,limit:e.limit,originPattern:"gw/devices/:id",isEnabled:!!+e.size[0],config:e.config.logs},on:{"view-log-message":e.viewLogMessagesHandler}}):e._e(),+e.size[1]?i("messages",{ref:"messages",style:[{height:"calc("+e.size[1]+"vh - "+(+e.size[0]?e.isVisibleToolbar?"50px":"25px":e.isVisibleToolbar?"100px":"50px")+")",position:"relative"},{maxWidth:e.mapMinimizedOptions.value&&e.mapMinimizedOptions.type&&"messages"===e.mapMinimizedOptions.type?"66%":""}],attrs:{mode:e.mode,item:e.selectedItem,activeId:e.active,isEnabled:!!+e.size[1],limit:e.limit,config:e.config.messages},on:{"view-data":e.viewDataHandler}}):e._e()],1):e._e(),!e.items.length&&e.isItemsInit?i("div",{staticClass:"text-center text-grey-3 q-mt-lg"},[i("div",{staticStyle:{"font-size":"2rem"}},[e._v(e._s(e.isLoading?"Fetching data..":"Devices not found"))]),!e.isLoading&&e.needShowGetDeletedAction&&1===e.tokenType?i("q-btn",{staticClass:"q-mt-sm",attrs:{icon:"mdi-download",label:"see deleted"},on:{click:e.getDeletedHandler}}):e._e()],1):e._e(),e.active&&e.messagesWithPosition.length&&e.$q.platform.is.desktop&&e.isVisibleMap?i("map-component",{ref:"map",attrs:{messages:e.messagesWithPosition,device:e.selectedItem,siblingHeight:e.siblingHeight},on:{"map:close":function(t){e.isVisibleMap=!1},"map:minimize":e.mapMinimizeHandler}}):e._e()],1)},n=[],a=(i("8e6e"),i("8a81"),i("456d"),i("28a5"),i("967e")),o=i.n(a),r=(i("96cf"),i("c5f6"),i("55dd"),i("7f7f"),i("ac6a"),i("cadf"),i("06db"),i("8615"),i("c47a")),c=i.n(r),l=i("2ce0"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("virtual-scroll-list",{ref:"scrollList",attrs:{cols:e.cols,actions:e.actions,items:e.messages,date:e.from,mode:e.mode,viewConfig:e.viewConfig,colsConfigurator:"toolbar",i18n:e.i18n,filter:e.filter,theme:e.theme,title:"Messages",loading:e.loadingFlag},on:{"change:filter":e.filterChangeHandler,"change:pagination-prev":e.paginationPrevChangeHandler,"change:pagination-next":e.paginationNextChangeHandler,"change:date":e.dateChangeHandler,"change:date-prev":e.datePrevChangeHandler,"change:date-next":e.dateNextChangeHandler,"change:mode":e.modeChange,"update:cols":e.updateColsHandler},scopedSlots:e._u([{key:"items",fn:function(t){var s=t.item,n=t.index,a=t.actions,o=t.cols,r=t.etcVisible,c=t.actionsVisible,l=t.itemHeight,m=t.rowWidth;return i("messages-list-item",{key:""+JSON.stringify(s)+n,attrs:{item:s,index:n,actions:a,cols:o,itemHeight:l,rowWidth:m,etcVisible:r,actionsVisible:c,selected:e.selected.includes(n)},on:{action:e.actionHandler,"item-click":e.viewMessagesHandler}})}}])})],1)},h=[],d=i("de45"),u=i("2b0e"),p=i("bd4c"),g=i("cdde"),f=i("ef95"),v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px"}},[e.item["__connectionStatus"]||e.item["x-flespi-filter-prev"]||e.item["x-flespi-filter-next"]?e.item["x-flespi-filter-prev"]||e.item["x-flespi-filter-next"]?i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",color:"#000",fontWeight:"bold",backgroundColor:e.item["x-flespi-filter-prev"]?"#819002":"#ccb300",overflow:"hidden"}},[i("span",{staticClass:"text-uppercase text-white",staticStyle:{padding:"0 5px"}},[e._v(e._s(e.item["x-flespi-filter-next"]?'Next results will be filtered by: "'+e.item["x-flespi-filter-next"]+'"':'Filter removed: "'+e.item["x-flespi-filter-prev"]+'"'))])]):i("div",{style:{height:e.itemHeight+"px",width:e.rowWidth+"px",border:"solid 1px #000",color:"#000",fontWeight:"bold",backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0",backgroundImage:"url(./statics/police.png)",overflow:"hidden",opacity:".7"},attrs:{title:e.date.formatDate(1e3*e.item.timestamp,"DD/MM/YYYY HH:mm:ss")}},e._l(Array(10),(function(t){return i("span",{key:t,staticClass:"text-uppercase",staticStyle:{padding:"0 5px","margin-left":"150px"},style:{backgroundColor:"offline"===e.item.__connectionStatus?"#ff0":"#0f0"}},[e._v("\n    "+e._s(e.item["__connectionStatus"])+"\n  ")])})),0):i("div",{staticClass:"cursor-pointer",class:[e.item.__status?"missed-items":"",e.selected?"bg-white-opasity":e.highlightLevel?"text-"+e.highlightType+"-"+e.highlightLevel:""],style:{height:e.itemHeight+"px",width:e.rowWidth+"px",color:e.selected?"#333":"",borderBottom:e.item.delimiter?"solid 1px #f40":""},on:{click:function(t){return e.itemClickHandler(e.index,e.clearItem)}}},[e.actionsVisible?i("span",{staticClass:"list__item item_actions"},e._l(e.actions,(function(t,s){return i("q-icon",{key:s,staticClass:"cursor-pointer on-left",class:t.classes,attrs:{name:t.icon},nativeOn:{click:function(i){return i.stopPropagation(),e.clickHandler(e.index,t.type,e.item)}}},[i("q-tooltip",[e._v(e._s(t.label))])],1)})),1):e._e(),e._l(e.cols,(function(t,s){var n;return i("span",{key:t.name+s,staticClass:"list__item",class:(n={},n["item_"+s]=!0,n),style:{color:e.item["x-flespi-filter-fields"]&&e.item["x-flespi-filter-fields"].includes(t.name)?"#4caf50":""},attrs:{title:e.values[t.name].value}},[e._v("\n    "+e._s(e.values[t.name].value)+"\n  ")])})),e.etcVisible?i("span",{staticClass:"list__item item_etc"},[e._v("\n    "+e._s(e.values.etc.value||"*Empty*")+"\n  ")]):e._e()],2)])},x=[],b=(i("4917"),i("8993")),w=i.n(b),M={props:["item","index","actions","cols","itemHeight","etcVisible","rowWidth","actionsVisible","selected"],data:function(){var e=0,t="";return this.item.timestamp<this.item["server.timestamp"]-1800?(t="orange",e=10):this.item.timestamp<this.item["server.timestamp"]-600?(t="orange",e=7):this.item.timestamp<this.item["server.timestamp"]-120?(t="orange",e=4):this.item.timestamp-1>this.item["server.timestamp"]?(t="grey",e=6):this.item.timestamp-60>this.item["server.timestamp"]?(t="grey",e=8):this.item.timestamp-1800>this.item["server.timestamp"]&&(t="grey",e=10),{highlightType:t,highlightLevel:e,date:p["b"]}},computed:{values:function(){var e=this,t={};return t=this.cols.length?this.cols.reduce((function(e,t,i,s){return e[t.name]={value:null},i===s.length-1&&(e.etc={value:""}),e}),{}):{etc:{value:""}},Object.keys(this.item).forEach((function(i){if(-1!==i.indexOf("#")){var s=i.split("#"),n=s[0],a=s[1];if(t[n]){if(t[n].value){if("object"!==w()(t[n].value)){var o=t[n].value;t[n].value=c()({},a-1,o)}}else t[n].value={};t[n].value[a]=JSON.stringify(e.item[i])}else t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}else if(t[i]){var r=e.item[i];i.match(/timestamp$/)&&(r=p["b"].formatDate(1e3*r,"DD/MM/YYYY HH:mm:ss")),-1!==i.indexOf("image.bin.")&&(r="<binary image>"),t[i].value="string"===typeof r?r:JSON.stringify(r)}else{if("delimiter"===i||"__status"===i||"x-flespi-filter-fields"===i||"x-flespi-filter-next"===i||"x-flespi-filter-prev"===i)return!1;-1!==i.indexOf("image.bin.")?t.etc.value+="".concat(i,": <binary image>"):t.etc.value+="".concat(i,": ").concat(JSON.stringify(e.item[i]),"; ")}})),Object.keys(t).forEach((function(e){if("object"===w()(t[e].value)&&t[e].value)if(t[e].value instanceof Array){var i=t[e].value.reduce((function(e,t,i,s){return e+=t,i!==s.length-1&&(e+=", "),e}),"");t[e].value=i}else if(t[e].value instanceof Object){var s=Object.keys(t[e].value).reduce((function(i,s,n,a){return i+="".concat(s,": ").concat(t[e].value[s]),n!==a.length-1&&(i+=", "),i}),"");t[e].value=s}})),t},clearItem:function(){var e=this;return Object.keys(this.item).reduce((function(t,i){return"delimiter"===i||"__status"===i||"x-flespi-filter-fields"===i||"x-flespi-filter-next"===i||"x-flespi-filter-prev"===i?t:(t[i]=e.item[i],t)}),{})}},methods:{clickHandler:function(e,t,i){this.$emit("action",{index:e,type:t,content:i})},itemClickHandler:function(e,t){this.$emit("item-click",{index:e,content:t})}}},y=M,$=(i("44e7"),i("2877")),z=Object($["a"])(y,v,x,!1,null,null,null),H=z.exports,_={props:["mode","item","activeId","limit","config"],data:function(){return{theme:this.config.theme,i18n:{},viewConfig:this.config.viewConfig,actions:this.config.actions,moduleName:this.config.vuexModuleName}},computed:{messages:{get:function(){var e=this.$store.state[this.moduleName].messages;return this.setTranslate(e),e},set:function(e){this.$store.commit("".concat(this.moduleName,"/setMessages"),e)}},active:{get:function(){return this.$store.state[this.moduleName].active},set:function(e){return o.a.async((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling")));case 2:if(this.$store.commit("".concat(this.moduleName,"/setActive"),e),this.$store.commit("".concat(this.moduleName,"/clearMessages")),null===this.$store.state[this.moduleName].mode){t.next=18;break}return t.next=7,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/getCols")));case 7:if(0!==this.$store.state[this.moduleName].mode){t.next=14;break}return t.next=10,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/initTime")));case 10:return t.next=12,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/get")));case 12:t.next=15;break;case 14:1===this.$store.state[this.moduleName].mode&&this.$store.dispatch("".concat(this.moduleName,"/pollingGet"));case 15:if(1!==this.$store.state[this.moduleName].mode||this.item.deleted){t.next=18;break}return t.next=18,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/getHistory"),200));case 18:case"end":return t.stop()}}),null,this)}},cols:{get:function(){return this.$store.state[this.moduleName].cols},set:function(e){this.$store.commit("".concat(this.moduleName,"/updateCols"),e)}},filter:{get:function(){return this.$store.state[this.moduleName].filter},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFilter"),e):this.$store.commit("".concat(this.moduleName,"/setFilter"),"")}},from:{get:function(){return this.$store.state[this.moduleName].from},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setFrom"),e):this.$store.commit("".concat(this.moduleName,"/setFrom"),0)}},to:{get:function(){return this.$store.state[this.moduleName].to},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setTo"),e):this.$store.commit("".concat(this.moduleName,"/setTo"),0)}},reverse:{get:function(){return this.$store.state[this.moduleName].reverse||!1},set:function(e){this.$store.commit("".concat(this.moduleName,"/setReverse"),e)}},currentLimit:{get:function(){return this.$store.state[this.moduleName].limit},set:function(e){e?this.$store.commit("".concat(this.moduleName,"/setLimit"),e):this.$store.commit("".concat(this.moduleName,"/setLimit"),1e3)}},selected:{get:function(){return this.$store.state[this.moduleName].selected},set:function(e){this.$store.commit("".concat(this.moduleName,"/setSelected"),e)}},loadingFlag:function(){var e=this.$store.state;return!(!e[this.config.vuexModuleName]||!e[this.config.vuexModuleName].isLoading)}},methods:{resetParams:function(){this.$refs.scrollList.resetParams()},filterChangeHandler:function(e){this.filter!==e&&(this.filter=e,0===this.mode&&(this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.$store.dispatch("".concat(this.moduleName,"/get"))))},setTranslate:function(e){this.i18n.from=e.length?"Previous batch until ".concat(p["b"].formatDate(1e3*e[0].timestamp,"HH:mm:ss")):"Prev",this.i18n.to=e.length?"Next batch from ".concat(p["b"].formatDate(1e3*e[e.length-1].timestamp,"HH:mm:ss")):"Next"},modeChange:function(e){var t;return o.a.async((function(i){while(1)switch(i.prev=i.next){case 0:return t=null===this.$store.state[this.moduleName].mode,i.next=3,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling")));case 3:if(e=+e,this.$store.commit("".concat(this.moduleName,"/clearMessages")),this.$store.commit("".concat(this.moduleName,"/setMode"),e),1!==e||!this.active||null===this.$store.state[this.moduleName].mode){i.next=11;break}return i.next=9,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/getHistory"),200));case 9:return i.next=11,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/pollingGet")));case 11:if(0!==e||!this.active||this.item.deleted&&!t){i.next=16;break}return i.next=14,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/initTime")));case 14:return i.next=16,o.a.awrap(this.$store.dispatch("".concat(this.moduleName,"/get")));case 16:case"end":return i.stop()}}),null,this)},updateColsHandler:function(e){this.cols=e},dateChangeHandler:function(e){var t=new Date(e).setHours(0,0,0,0);t+=864e5,this.$store.commit("".concat(this.moduleName,"/setTo"),t),this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"setFrom",payload:e})},datePrevChangeHandler:function(){this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"datePrev"})},dateNextChangeHandler:function(){this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"dateNext"})},paginationPrevChangeHandler:function(){var e=0;e=this.messages.length?1e3*this.messages[0].timestamp:0,this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"paginationPrev",payload:e})},paginationNextChangeHandler:function(){var e=0;e=this.messages.length?1e3*this.messages[this.messages.length-1].timestamp:0,this.$store.dispatch("".concat(this.moduleName,"/get"),{name:"paginationNext",payload:e})},actionHandler:function(e){var t=e.index,i=e.type,s=e.content;switch(i){case"view":this.viewMessagesHandler({index:t,content:s});break;case"copy":this.copyMessageHandler({index:t,content:s});break}},viewMessagesHandler:function(e){var t=e.index,i=e.content;this.selected=[t],this.$emit("view-data",i)},copyMessageHandler:function(e){var t=this,i=(e.index,e.content);Object(g["a"])(JSON.stringify(i)).then((function(e){t.$q.notify({type:"positive",icon:"content_copy",message:"Message copied",timeout:1e3})}),(function(e){t.$q.notify({type:"negative",icon:"content_copy",message:"Error coping messages",timeout:1e3})}))},unselect:function(){this.selected.length&&(this.selected=[])}},watch:{activeId:function(e){this.active=e},mode:function(e){this.modeChange(e)},limit:function(e){this.currentLimit=e}},created:function(){var e=this;this.$store.state[this.moduleName]?this.$store.commit("".concat(this.moduleName,"/clear")):this.$store.registerModule(this.moduleName,Object(d["d"])({Vue:u["default"],LocalStorage:this.$q.localStorage,name:this.moduleName,errorHandler:function(t){e.$store.commit("reqFailed",t)},filterHandler:this.filterMessages})),this.currentLimit=this.limit,this.activeId&&(this.$store.commit("".concat(this.moduleName,"/setActive"),this.activeId),this.$store.dispatch("".concat(this.moduleName,"/getCols"))),null===this.$store.state[this.moduleName].mode&&this.modeChange(this.mode),this.offlineHandler=u["default"].connector.socket.on("offline",(function(){e.$store.commit("".concat(e.moduleName,"/setOffline"),1===e.mode)})),this.connectHandler=u["default"].connector.socket.on("connect",(function(){e.$store.state[e.moduleName].offline&&(e.$store.commit("".concat(e.moduleName,"/setReconnected"),1===e.mode),1===e.mode&&e.$store.dispatch("".concat(e.moduleName,"/getMissedMessages")))}))},beforeDestroy:function(){this.$store.dispatch("".concat(this.moduleName,"/unsubscribePooling")),void 0!==this.offlineHandler&&u["default"].connector.socket.off("offline",this.offlineHandler),void 0!==this.connectHandler&&u["default"].connector.socket.off("connect",this.connectHandler),this.$store.commit("".concat(this.moduleName,"/clear"))},mixins:[f["a"]],components:{VirtualScrollList:d["a"],MessagesListItem:H}},N=_,k=Object($["a"])(N,m,h,!1,null,null,null),C=k.exports,O=function(){var e,t=this,i=t.$createElement,s=t._self._c||i;return s("vue-draggable-resizable",{ref:"dragResize",staticClass:"map-component__wrapper",class:[t.isMapMinimized||t.isMapMaximized?"map-component--minimized":""],style:t.wrapperStyles,attrs:{active:!0,x:t.startX,y:t.startY,w:t.width,h:t.height,z:1e3,minw:100,minh:100,parent:!0},on:{resizing:t.mapResizeHandler,dragging:t.draggingHandler}},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isMapMinimized&&!t.isMapMaximized,expression:"!isMapMinimized && !isMapMaximized"}],staticClass:"map-container__header",staticStyle:{"padding-right":"1px","padding-top":"3px"},style:{height:t.headerMapHeight+"px"}},[s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-close",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.closeMapHandler(e)}}}),s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:t.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.maximizeHandler(e)}}}),0!==t.siblingHeight?s("q-icon",{staticClass:"float-right cursor-pointer",attrs:{name:"mdi-arrow-bottom-right",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.minimizeHandler("messages")}}}):t._e(),100!==t.siblingHeight?s("q-icon",{staticClass:"float-right cursor-pointer",class:(e={},e["height"+t.siblingHeight]=!0,e),attrs:{name:"mdi-arrow-top-right",color:"white"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.minimizeHandler("logs")}}}):t._e()],1),s("div",{style:t.mapStyles,attrs:{id:"map"}},[s("q-resize-observer",{on:{resize:t.onResize}})],1),t.isMapMinimized||t.isMapMaximized?s("div",{staticClass:"map-component__custom-controls"},[s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-close",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.closeMapHandler(e)}}}),t.isMapMinimized?s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:"mdi-window-restore",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.restoreHandler(e)}}}):t._e(),t.isMapMaximized?s("q-icon",{staticClass:"pull-right cursor-pointer",attrs:{name:t.isMapMaximized?"mdi-fullscreen-exit":"mdi-fullscreen",size:"30px",color:"grey-9"},nativeOn:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.maximizeHandler(e)}}}):t._e()],1):t._e()])},q=[],I=i("e11eb"),T=(i("6cc5"),i("fb19")),D=i.n(T),L={name:"map-component",props:["messages","device","siblingHeight"],data:function(){return{map:null,marker:null,track:null,zoom:10,color:"#037be3",height:520,width:500,prevWidth:0,prevHeight:0,headerMapHeight:20,startX:50,startY:50,isMapMinimized:!1,isMapMaximized:!1,minimizeTo:"",winWidth:0,winHeight:0}},computed:{mapStyles:function(){var e={};return this.device&&this.messages&&this.messages.length&&(e.width="".concat(this.width,"px"),e.height="".concat(this.height-(this.isMapMinimized||this.isMapMaximized?0:this.headerMapHeight),"px")),e},wrapperStyles:function(){var e={};return this.device&&this.messages&&this.messages.length&&(e={width:"".concat(this.width,"px"),height:"".concat(this.height,"px"),position:"absolute",backgroundColor:"#666"}),e}},methods:{initMap:function(){var e=this;if(!this.map){var t=this.messages.length?this.messages[this.messages.length-1]:{},i=t["position.latitude"]&&t["position.longitude"]?[t["position.latitude"],t["position.longitude"]]:[51.50853,-.12574];this.map=I["map"]("map",{center:i,zoom:this.zoom,attributionControl:!1,maxBounds:[[90,-180],[-90,180]]}),this.map.addEventListener("zoom",(function(t){e.zoom=t.target.getZoom()})),this.map.addEventListener("mousedown",(function(e){e.originalEvent.stopPropagation()})),I["control"].attribution({prefix:'<span class="leaflet-map__attribution">Leaflet</span>'}).addTo(this.map),I["tileLayer"]("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{minZoom:3,noWrap:!0}).addTo(this.map)}},flyTo:function(e){this.map.flyTo(e)},closeMapHandler:function(){this.$emit("map:close"),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},maximizeHandler:function(){this.isMapMaximized?(this.width=this.prevWidth,this.height=this.prevHeight,this.isMapMaximized=!1):(this.prevWidth=this.width,this.prevHeight=this.height,this.maximize())},minimizeHandler:function(e){this.$emit("map:minimize",{type:e,value:!0}),this.prevWidth=this.width,this.prevHeight=this.height,this.isMapMinimized=!0,this.minimizeTo=e,this.isMapMaximized&&(this.isMapMaximized=!1)},restoreHandler:function(){this.$emit("map:minimize",{value:!0}),this.isMapMinimized=!1,this.minimizeTo="",this.$refs.dragResize.left=50,this.$refs.dragResize.top=50},minimize:function(e){var t=this,i=parseInt(this.$el.parentNode.clientWidth,10),s=parseInt(this.$el.parentNode.clientHeight,10);switch(this.width=.34*i,this.height=(s-50)*(this.siblingHeight/100)-(100===this.siblingHeight?0:50-this.siblingHeight),e){case"messages":this.$nextTick((function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=s-t.height}));break;case"logs":this.$nextTick((function(){t.$refs.dragResize.left=.66*i,t.$refs.dragResize.top=50}))}},maximize:function(){var e=this,t=parseInt(this.$el.parentNode.clientWidth,10)-1,i=parseInt(this.$el.parentNode.clientHeight,10);this.width=t,this.height=i,this.$nextTick((function(){e.$refs.dragResize.left=0,e.$refs.dragResize.top=0})),this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized=!0},mapResizeHandler:function(e,t,i,s){this.width=i,this.height=s},generateIcon:function(){return I["divIcon"]({className:"my-div-icon icon-".concat(this.device.id),iconSize:new I["Point"](20,20),html:'<div style="border-color: '.concat(this.color,"; transform: rotate(").concat((this.messages[this.messages.length-1]["position.direction"]||0)-45,'deg)" class="my-div-icon__inner"></div><div class="my-div-icon__name">').concat(this.device.name,"</div>")})},onResize:function(){this.map&&this.map.invalidateSize()},onWindowResize:function(e){if(this.onResize(),this.isMapMinimized)this.minimizeHandler(this.minimizeTo),this.minimize(this.minimizeTo);else if(this.isMapMaximized)this.maximize();else{if(this.winWidth>e.width){var t=this.$refs.dragResize.left,i=this.winWidth-e.width;t+this.width>=this.winWidth-30&&(t&&(t-=i,t<0&&(i=-1*t,t=0),this.$refs.dragResize.left=t),0===t&&(this.$refs.dragResize.width-=i,this.width-=i,this.width<100&&(this.$refs.dragResize.width=100,this.width=100)))}if(this.winHeight>e.height){var s=this.$refs.dragResize.top,n=this.winHeight-e.height;s+this.height>=this.winHeight-30&&(s&&(s-=n,s<0&&(n=-1*s,s=0),this.$refs.dragResize.top=s),0===s&&(this.$refs.dragResize.height-=n,this.height-=n,this.height<100&&(this.$refs.dragResize.height=100,this.height=100)))}this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth}},draggingHandler:function(){this.isMapMinimized&&(this.$emit("map:minimize",{value:!1}),this.minimizeTo="",this.isMapMinimized=!1),this.isMapMaximized&&(this.isMapMaximized=!1)},getLatLngArr:function(){return this.messages.reduce((function(e,t){return e.push([t["position.latitude"],t["position.longitude"]]),e}),[])},updateMarkerHandler:function(e){var t=e.lastPos;this.marker&&this.marker.setLatLng(t).update()},initMarker:function(){var e=this,t=this.messages[this.messages.length-1],i=[t["position.latitude"],t["position.longitude"]];this.marker=I["marker"](i,{icon:this.generateIcon(),title:this.device.name}),this.marker.addEventListener("move",(function(t){e.marker.setIcon(e.generateIcon()),e.marker.update()})),this.marker.addTo(this.map)},initDeviceOnMap:function(){this.initMarker(),this.track=I["polyline"](this.getLatLngArr(),{color:this.color}).addTo(this.map)},updateDeviceOnMap:function(){var e=this.getLatLngArr(),t=this.marker&&this.marker instanceof I["Marker"]?this.marker.getLatLng():{},i=this.messages&&this.messages.length&&t.lat&&t.lat!==this.messages[this.messages.length-1]["position.latitude"]&&t.lng&&t.lng!==this.messages[this.messages.length-1]["position.longitude"];i&&this.map.flyTo(e[this.messages.length-1],this.zoom),this.messages.length&&(this.marker instanceof I["Marker"]||this.initMarker(),this.track instanceof I["Polyline"]||(this.track=I["polyline"](this.getLatLngArr(),{color:this.color}).addTo(this.map))),this.marker.setLatLng(e[this.messages.length-1]).update(),this.marker.setOpacity(1),this.track.setLatLngs(e)}},mounted:function(){this.initMap(),this.initDeviceOnMap(),this.winHeight=document.documentElement.clientHeight,this.winWidth=document.documentElement.clientWidth},watch:{messages:function(e){this.updateDeviceOnMap()},"$q.screen.width":{immediate:!0,handler:function(e){this.onWindowResize({height:this.$q.screen.height,width:e})}},"$q.screen.height":{immediate:!0,handler:function(e){this.onWindowResize({width:this.$q.screen.width,height:e})}},minimizeTo:function(e){e?this.minimize(e):(this.width=this.prevWidth,this.height=this.prevHeight)}},components:{VueDraggableResizable:D.a}},S=L,P=(i("4ac8"),Object($["a"])(S,O,q,!1,null,null,null)),E=P.exports,W=i("a99a"),j=i("2f62"),R=i("286e"),V=i("9b02"),A=i.n(V);function F(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function Y(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?F(Object(i),!0).forEach((function(t){c()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var G={props:["limit","isLoading","isVisibleToolbar","isNeedSelect","config","settings"],mixins:[R["a"]],data:function(){return{filter:"",mode:1,active:null,ratio:50,isInit:!1,isItemsInit:!1,isVisibleMap:!1,mapMinimizedOptions:{},siblingHeight:null,needShowGetDeletedAction:!0}},computed:Y({},Object(j["d"])({isEmptyMessages:function(e){var t=this.config.messages&&e[this.config.messages.vuexModuleName]&&!e[this.config.messages.vuexModuleName].messages.length&&100!==this.ratio,i=this.config.logs&&e[this.config.logs.vuexModuleName]&&e[this.config.logs.vuexModuleName].messages&&!e[this.config.logs.vuexModuleName].messages.length&&0!==this.ratio;return t&&i},tokenType:function(e){return e.tokenInfo&&e.tokenInfo.access?e.tokenInfo.access.type:-1},itemsCollection:function(e){return e.devices||{}},tasksByDevice:function(e){return Object.values(e.tasks||{})}}),{items:function(){return Object.values(this.itemsCollection)},selectedItem:function(){var e=this.itemsCollection&&this.itemsCollection[this.active]||null;return e&&e.deleted&&this.deletedHandler(),e},filteredItems:function(){var e=this.filter.toLowerCase(),t=this.filter?this.items.filter((function(t){return t&&"undefined"!==typeof t.name&&null!==t.name&&t.name.toLowerCase().indexOf(e)>=0||t&&"undefined"!==typeof t.id&&null!==t.id&&(t.id+"").indexOf(e)>=0||t&&t.configuration&&"undefined"!==typeof t.configuration.ident&&null!==t.configuration.ident&&t.configuration.ident.toLowerCase().indexOf(e)>=0})):this.items;return t.sort((function(e,t){if(!e.name)return-1;if(!t.name)return 1;var i=e.name.toLowerCase(),s=t.name.toLowerCase();return i<s?-1:1})),t},size:function(){return[this.ratio,100-this.ratio]},messagesWithPosition:function(){return this.config&&this.config.messages&&this.$store.state[this.config.messages.vuexModuleName]?this.$store.state[this.config.messages.vuexModuleName].messages.filter((function(e){return!!e["position.latitude"]&&!!e["position.longitude"]})):[]},modeModel:{get:function(){return!!this.mode},set:function(e){var t=Date.now();this.date=e?0:t-t%864e5,this.mode=Number(e),this.$emit("view-data-hide")}},actions:function(){var e=this;return[{label:"Intervals",icon:"mdi-set-center",handler:function(){return e.moveToIntervals(e.active,null)},condition:!!this.tasksByDevice.length},{label:"Map",icon:"mdi-map",handler:function(){return e.setMapVisibility(!e.isVisibleMap)},condition:!!this.messagesWithPosition.length},{label:"Clear",icon:"mdi-playlist-remove",handler:this.clearHandler,condition:this.modeModel&&!this.isEmptyMessages}]}}),methods:Y({},Object(j["b"])(["getDeleted"]),{filterItems:function(e,t){var i=this;if(this.isItemsInit)t();else{var s="devices";this.itemsLoad(s,t,this.active,(function(){i.isItemsInit=!0}))}},viewDataHandler:function(e){this.$emit("view-data",e),this.isVisibleMap&&e["position.latitude"]&&e["position.longitude"]&&this.$refs.map.flyTo([e["position.latitude"],e["position.longitude"]])},viewLogMessagesHandler:function(e){this.$emit("view-log-message",e)},unselect:function(){this.$refs.messages.unselect()},showMap:function(){this.messagesWithPosition.length&&(this.isVisibleMap=!this.isVisibleMap)},mapMinimizeHandler:function(e){this.mapMinimizedOptions=e,"messages"===e.type?this.siblingHeight=this.size[1]:"logs"===e.type?this.siblingHeight=this.size[0]:this.siblingHeight=null},clearHandler:function(){var e=this;this.$q.dialog({title:"Confirm",message:"Do you really want to clear all data from the panes?",ok:!0,cancel:!0}).onOk((function(){e.$store.commit("".concat(e.config.messages.vuexModuleName,"/clearMessages")),e.$store.commit("".concat(e.config.logs.vuexModuleName,"/clearMessages"))})).onCancel((function(){}))},getDeletedHandler:function(){return o.a.async((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.a.awrap(this.getDeleted("devices"));case 2:this.needShowGetDeletedAction=!1,this.$refs.itemSelect.reset();case 4:case"end":return e.stop()}}),null,this)},clearActive:function(){this.active=null},deletedHandler:function(){this.ratio=100,this.mode=0},init:function(){var e,t="devices",i=A()(this.settings,"entities[".concat(t,"]"),void 0),s=this.$route.params&&this.$route.params.id?this.$route.params.id:null;if(this.isInit=!0,s){if(s=s.split("-"),s.length>1?(e=Number(s[1]),s=Number(s[0])):1===s.length&&(s=Number(s[0])),e)return this.moveToIntervals(s,e),!1;this.itemsCollection[s]?this.active=s:this.active=null}else i&&this.itemsCollection[i]&&(this.active=i);this.selectedItem&&this.selectedItem.deleted&&this.deletedHandler(),this.$emit("inited")},moveToIntervals:function(e,t){var i=this;this.$nextTick((function(){i.$router.push("/devices/".concat(e,"/calc/").concat(t,"/intervals")).catch((function(e){return e}))}))},setMapVisibility:function(e){this.isVisibleMap=e}}),watch:{ratio:function(e){var t=this;this.$nextTick((function(){+t.size[0]&&t.active&&(t.$refs.logs.resetParams(),t.$emit("view-data-hide")),+t.size[1]&&t.active&&t.$refs.messages.resetParams()}))},$route:function(e){e.params&&e.params.id?this.itemsCollection[Number(e.params.id)]?this.active=Number(e.params.id):this.isInit&&(this.active=null):e.params&&!e.params.id&&(this.active=null)},active:function(e,t){var i=this.itemsCollection[e]||{};e?(this.$emit("update:settings",{type:"ENTITY_CHANGE",opt:{entity:"devices"},value:i.id}),this.$router.push("/devices/".concat(e)).catch((function(e){return e}))):this.$router.push("/devices").catch((function(e){return e})),i.deleted?this.deletedHandler():this.ratio=i.deleted?100:50}},components:{logs:l["a"],messages:C,MapComponent:E,EntitiesToolbar:W["a"]}},J=G,B=(i("2378"),Object($["a"])(J,s,n,!1,null,null,null));t["default"]=B.exports},cc75:function(e,t,i){}}]);